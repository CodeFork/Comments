(function(){function u(){for(var u,r,t=document.getElementsByTagName("span"),n=0,f=t.length;n<f;n++)u=t[n],r=t[n].getAttribute("data-comments-url"),r!=null&&i.getCommentsCount(r,function(n){u.innerText=n})}function f(){var n=document.getElementById("comments-middleware");i.getView(function(t){n.innerHTML=t})}function n(){u();f()}var t="/comments-middleware",r=new function(){var n=this;n.get=function(n,t){var i=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");return i.open("GET",n),i.onreadystatechange=function(){i.readyState>3&&i.status>=200&&i.status<300&&t(i.responseText)},i.setRequestHeader("X-Requested-With","XMLHttpRequest"),i.send(),i};n.post=function(n,t,i){var r=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");return r.open("POST",n),r.onreadystatechange=function(){r.readyState>3&&r.status>=200&&r.status<300&&i(r.responseText)},r.setRequestHeader("X-Requested-With","XMLHttpRequest"),r.send(params),r}},i=new function(n){var i=this;i.getCommentsCount=function(i,r){url=t+"/count?url="+encodeURIComponent(i);n.get(url,r)};i.getView=function(i){url=t+"/view.html";n.get(url,i)}}(r),e=function(){function t(){return!0}var n=this;n.loading=ko.observable(!1);n.previewVisible=ko.observable(!1);n.source=ko.observable("");n.rendered=ko.observable("");n.doPost=function(){t()&&console.log("post comment")}};document.readyState!=="loading"?n():document.addEventListener?document.addEventListener("DOMContentLoaded",n):document.attachEvent("onreadystatechange",function(){document.readyState==="complete"&&n()})})();